(()=>{var e={56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var s={},i=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],d=s[l]||0,u="".concat(l," ").concat(d);s[l]=d+1;var g=n(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==g)t[g].references++,t[g].updater(m);else{var p=o(m,r);r.byIndex=a,t.splice(a,0,{identifier:u,updater:p,references:1})}i.push(u)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var s=r(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<s.length;i++){var a=n(s[i]);t[a].references--}for(var c=r(e,o),l=0;l<s.length;l++){var d=n(s[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}s=c}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},159:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n}).join("")},t.i=function(e,n,r,o,s){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(i[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);r&&i[d[0]]||(void 0!==s&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=s),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),o&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=o):d[4]="".concat(o)),t.push(d))}},t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},640:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var r=n(601),o=n.n(r),s=n(314),i=n.n(s)()(o());i.push([e.id,":root {\n  --etts-bg-primary: #ffffff;\n  --etts-bg-secondary: #f8f9fa;\n  --etts-text-primary: #000000;\n  --etts-text-secondary: #666666;\n  --etts-border-color: #cccccc;\n  --etts-button-bg: #007bff;\n  --etts-button-text: #ffffff;\n  --etts-hover-bg: #0056b3;\n}\n\n[data-theme='dark'] {\n  --etts-bg-primary: #1a1a1a;\n  --etts-bg-secondary: #2d2d2d;\n  --etts-text-primary: #ffffff;\n  --etts-text-secondary: #cccccc;\n  --etts-border-color: #404040;\n  --etts-button-bg: #0d6efd;\n  --etts-button-text: #ffffff;\n  --etts-hover-bg: #0b5ed7;\n}\n\n.etts-flex-center {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n}\n\n.etts-tts-icon {\n  width: 1rem;\n  height: 1rem;\n  margin-right: 0.25rem;\n  fill: none;\n  stroke: currentColor;\n}\n\n.etts-tts-input {\n  width: 100%;\n  padding-left: 0.75rem;\n  padding-right: 0.75rem;\n  padding-top: 0.5rem;\n  padding-bottom: 0.5rem;\n  border: 1px solid #d1d5db;\n  border-radius: 0.375rem;\n  outline: none;\n}\n\n.etts-tts-input.etts-dark {\n  background-color: #1f2937;\n  border-color: #4b5563;\n  color: white;\n}\n\n.etts-transition-all {\n  transition: all 0.2s ease-in-out;\n}\n\n.etts-min-width-200 {\n  min-width: 200px;\n}\n\n.etts-space-x-3 {\n  display: flex;\n  gap: 0.75rem;\n}\n\n.etts-space-y-3 {\n  display: flex;\n  flex-direction: column;\n  gap: 0.75rem;\n}\n\n.etts-animate-spin {\n  animation: etts-spin 1s linear infinite;\n}\n\n@keyframes etts-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n.etts-spinner {\n  height: 1.25rem;\n  width: 1.25rem;\n  border: 2px solid #2563eb;\n  border-radius: 50%;\n  border-top-color: transparent;\n}\n\n.etts-lucide {\n  width: 20px;\n  height: 20px;\n  stroke: var(--etts-button-text);\n}\n\n.etts-tts-controls {\n  position: fixed;\n  bottom: 20px;\n  right: 20px;\n  background: var(--etts-bg-primary);\n  color: var(--etts-text-primary);\n  border: 1px solid var(--etts-border-color);\n  border-radius: 8px;\n  padding: 15px;\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n  z-index: 10000;\n  min-width: 200px;\n  transition: all 0.2s;\n}\n\n.etts-tts-button {\n  background: var(--etts-button-bg);\n  color: var(--etts-button-text);\n  border: none;\n  border-radius: 4px;\n  padding: 8px 16px;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n}\n\n.etts-tts-button:hover {\n  background: var(--etts-hover-bg);\n}\n\n.etts-tts-button.etts-red {\n  background: #dc3545;\n}\n\n.etts-tts-button.etts-red:hover {\n  background: #bb2d3b;\n}\n\n.etts-loading-spinner {\n  border: 2px solid var(--etts-bg-secondary);\n  border-top: 2px solid var(--etts-button-bg);\n  border-radius: 50%;\n  width: 20px;\n  height: 20px;\n  animation: etts-spin 1s linear infinite;\n}\n\n.etts-loading-container {\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  justify-content: center;\n  gap: 1rem;\n}\n\n.etts-error-container {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 12px;\n  padding: 8px 4px;\n  max-width: 320px;\n}\n\n.etts-error-header {\n  color: #ef4444; /* Red-500 */\n  font-weight: 600;\n  font-size: 1rem;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.etts-error-message {\n  font-size: 0.875rem;\n  line-height: 1.4;\n  opacity: 0.9;\n  color: var(--etts-text-secondary);\n}\n\n.etts-error-actions {\n  width: 100%;\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 4px;\n}\n",""]);const a=i},659:e=>{"use strict";var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},815:function(e,t){var n,r;"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,n=function(e){"use strict";if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)e.exports=globalThis.browser;else{const t="The message port closed before a response was received.",n=e=>{const n={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(0===Object.keys(n).length)throw new Error("api-metadata.json has not been included in browser-polyfill");class r extends WeakMap{constructor(e,t=void 0){super(t),this.createItem=e}get(e){return this.has(e)||this.set(e,this.createItem(e)),super.get(e)}}const o=(t,n)=>(...r)=>{e.runtime.lastError?t.reject(new Error(e.runtime.lastError.message)):n.singleCallbackArg||r.length<=1&&!1!==n.singleCallbackArg?t.resolve(r[0]):t.resolve(r)},s=e=>1==e?"argument":"arguments",i=(e,t,n)=>new Proxy(t,{apply:(t,r,o)=>n.call(r,e,...o)});let a=Function.call.bind(Object.prototype.hasOwnProperty);const c=(e,t={},n={})=>{let r=Object.create(null),l={has:(t,n)=>n in e||n in r,get(l,d,u){if(d in r)return r[d];if(!(d in e))return;let g=e[d];if("function"==typeof g)if("function"==typeof t[d])g=i(e,e[d],t[d]);else if(a(n,d)){let t=((e,t)=>function(n,...r){if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise((s,i)=>{if(t.fallbackToNoCallback)try{n[e](...r,o({resolve:s,reject:i},t))}catch(o){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,o),n[e](...r),t.fallbackToNoCallback=!1,t.noCallback=!0,s()}else t.noCallback?(n[e](...r),s()):n[e](...r,o({resolve:s,reject:i},t))})})(d,n[d]);g=i(e,e[d],t)}else g=g.bind(e);else if("object"==typeof g&&null!==g&&(a(t,d)||a(n,d)))g=c(g,t[d],n[d]);else{if(!a(n,"*"))return Object.defineProperty(r,d,{configurable:!0,enumerable:!0,get:()=>e[d],set(t){e[d]=t}}),g;g=c(g,t[d],n["*"])}return r[d]=g,g},set:(t,n,o,s)=>(n in r?r[n]=o:e[n]=o,!0),defineProperty:(e,t,n)=>Reflect.defineProperty(r,t,n),deleteProperty:(e,t)=>Reflect.deleteProperty(r,t)},d=Object.create(e);return new Proxy(d,l)},l=e=>({addListener(t,n,...r){t.addListener(e.get(n),...r)},hasListener:(t,n)=>t.hasListener(e.get(n)),removeListener(t,n){t.removeListener(e.get(n))}}),d=new r(e=>"function"!=typeof e?e:function(t){const n=c(t,{},{getContent:{minArgs:0,maxArgs:0}});e(n)}),u=new r(e=>"function"!=typeof e?e:function(t,n,r){let o,s,i=!1,a=new Promise(e=>{o=function(t){i=!0,e(t)}});try{s=e(t,n,o)}catch(e){s=Promise.reject(e)}const c=!0!==s&&((l=s)&&"object"==typeof l&&"function"==typeof l.then);var l;if(!0!==s&&!c&&!i)return!1;return(c?s:a).then(e=>{r(e)},e=>{let t;t=e&&(e instanceof Error||"string"==typeof e.message)?e.message:"An unexpected error occurred",r({__mozWebExtensionPolyfillReject__:!0,message:t})}).catch(e=>{console.error("Failed to send onMessage rejected reply",e)}),!0}),g=({reject:n,resolve:r},o)=>{e.runtime.lastError?e.runtime.lastError.message===t?r():n(new Error(e.runtime.lastError.message)):o&&o.__mozWebExtensionPolyfillReject__?n(new Error(o.message)):r(o)},m=(e,t,n,...r)=>{if(r.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${s(t.minArgs)} for ${e}(), got ${r.length}`);if(r.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${s(t.maxArgs)} for ${e}(), got ${r.length}`);return new Promise((e,t)=>{const o=g.bind(null,{resolve:e,reject:t});r.push(o),n.sendMessage(...r)})},p={devtools:{network:{onRequestFinished:l(d)}},runtime:{onMessage:l(u),onMessageExternal:l(u),sendMessage:m.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:m.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},f={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return n.privacy={network:{"*":f},services:{"*":f},websites:{"*":f}},c(e,p,n)};e.exports=n(chrome)}},void 0===(r=n.apply(t,[e]))||(e.exports=r)},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={id:r,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0,(()=>{"use strict";var e=n(815),t=n.n(e),r=n(72),o=n.n(r),s=n(825),i=n.n(s),a=n(659),c=n.n(a),l=n(56),d=n.n(l),u=n(159),g=n.n(u),m=n(113),p=n.n(m),f=n(640),h={};h.styleTagTransform=p(),h.setAttributes=d(),h.insert=c().bind(null,"head"),h.domAPI=i(),h.insertStyleElement=g(),o()(f.A,h),f.A&&f.A.locals&&f.A.locals;const A='\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-pause"><circle cx="12" cy="12" r="10"/><line x1="10" x2="10" y1="15" y2="9"/><line x1="14" x2="14" y1="15" y2="9"/></svg>\n',x='\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-stop"><circle cx="12" cy="12" r="10"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>\n';function v(){return e=this,n=arguments,o=function*(e=!0){const n=yield t().storage.sync.get({darkMode:!1}),r=document.createElement("div");return r.className="etts-tts-controls",r.id="tts-control-panel",n.darkMode&&(r.dataset.theme="dark"),y(r,e),document.body.appendChild(r),r},new((r=void 0)||(r=Promise))(function(t,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r(function(e){e(n)})).then(i,a)}c((o=o.apply(e,n||[])).next())});var e,n,r,o}function y(e,t,n){if(e.innerHTML=`\n\t\t${t?`\n\t\t\t<div class="etts-flex-center etts-loading-container">\n\t\t\t\t<span>Generating audio...</span>\n\t\t\t\t<div class="etts-loading-spinner"></div>\n\t\t\t\t<button id="tts-cancel" class="etts-tts-button etts-red">\n\t\t\t\t\t${x}\n\t\t\t\t\t<span>Cancel</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`:n?`\n\t\t\t<div class="etts-error-container">\n\t\t\t\t<div class="etts-error-header">\n\t\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>\n\t\t\t\t\t<span>TTS Server Error</span>\n\t\t\t\t</div>\n\t\t\t\t<div class="etts-error-message">\n\t\t\t\t\tMicrosoft's free TTS service is currently experiencing instability. Please try again later.\n\t\t\t\t</div>\n\t\t\t\t<div class="etts-error-actions">\n\t\t\t\t\t<button id="tts-close-error" class="etts-tts-button etts-red">\n\t\t\t\t\t\t${x}\n\t\t\t\t\t\t<span>Close</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`:`\n\t\t\t<div class="etts-flex-center">\n\t\t\t\t<button id="tts-pause" class="etts-tts-button">\n\t\t\t\t\t${A}\n\t\t\t\t\t<span>Pause</span>\n\t\t\t\t</button>\n\t\t\t\t<button id="tts-stop" class="etts-tts-button etts-red">\n\t\t\t\t\t${x}\n\t\t\t\t\t<span>Stop</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`}\n\t`,t){const t=e.querySelector("#tts-cancel");t&&t.addEventListener("click",()=>{var e,t;null===(t=(e=window).stopPlayback)||void 0===t||t.call(e)})}else if(n){const t=e.querySelector("#tts-close-error");t&&t.addEventListener("click",()=>{var e,t;null===(t=(e=window).stopPlayback)||void 0===t||t.call(e)})}else{const t=e.querySelector("#tts-pause"),n=e.querySelector("#tts-stop");t&&t.addEventListener("click",()=>{var e,t;null===(t=(e=window).togglePause)||void 0===t||t.call(e)}),n&&n.addEventListener("click",()=>{var e,t;null===(t=(e=window).stopPlayback)||void 0===t||t.call(e)})}}function b(e){const t=window.getSelection();if(!t||0===t.rangeCount)return document.body.innerText;try{const e=t.getRangeAt(0);return function(e,t){const n=[];if(e.nodeType===Node.TEXT_NODE){const r=(e.textContent||"").substring(t);r.trim()&&n.push(r)}const r=e.nodeType===Node.TEXT_NODE?e.parentElement:e;if(!r)return n.join("");const o=w();let s=o.nextNode(),i=!1;for(;s;){if(!i){if(s===e){i=!0,s=o.nextNode();continue}if(!T(s,e,t)){s=o.nextNode();continue}i=!0}const r=s.textContent;r&&r.trim()&&n.push(r),s=o.nextNode()}return i?n.join(" ").replace(/\s+/g," ").trim():function(e){const t=[];let n=e;for(;n;){const e=w();let r=e.nextNode();for(;r;){const n=r.textContent;n&&n.trim()&&t.push(n),r=e.nextNode()}n=n.nextElementSibling}const r=e.parentElement;if(r&&r!==document.body){let e=r.nextElementSibling;for(;e;){const n=w();let r=n.nextNode();for(;r;){const e=r.textContent;e&&e.trim()&&t.push(e),r=n.nextNode()}e=e.nextElementSibling}}return t.join(" ").replace(/\s+/g," ").trim()}(r)}(e.startContainer,e.startOffset)}catch(e){return console.warn("Error extracting text from selection:",e),document.body.innerText}}function w(e){return document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;if(!t)return NodeFilter.FILTER_REJECT;const n=window.getComputedStyle(t);if("none"===n.display||"hidden"===n.visibility)return NodeFilter.FILTER_REJECT;const r=t.tagName.toLowerCase();return["script","style","noscript"].includes(r)||0===(e.textContent||"").trim().length?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}})}function T(e,t,n){const r=document.createRange();r.setStart(t,n),r.setEnd(document.body,document.body.childNodes.length);try{return r.intersectsNode(e)}catch(n){return 0!==(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_FOLLOWING)}}function E(e){const t=window.getSelection();if(!t||0===t.rangeCount)return document.body.innerText;try{const t=document.body.innerText,n=t.indexOf(e);return-1!==n?t.substring(n):t}catch(e){return console.warn("Error in simple text extraction:",e),document.body.innerText}}class k extends Error{constructor(e){super(e),this.name="EdgeTTSException"}}class S extends k{constructor(e){super(e),this.name="SkewAdjustmentError"}}class C extends k{constructor(e){super(e),this.name="UnknownResponse"}}class P extends k{constructor(e){super(e),this.name="UnexpectedResponse"}}class N extends k{constructor(e){super(e),this.name="NoAudioReceived"}}class $ extends k{constructor(e){super(e),this.name="WebSocketError"}}class R extends k{constructor(e){super(e),this.name="ValueError"}}function M(){const e=new Uint8Array(16);globalThis.crypto.getRandomValues(e),e[6]=15&e[6]|64,e[8]=63&e[8]|128;const t=Array.from(e,e=>e.toString(16).padStart(2,"0")).join("");return`${t.slice(0,8)}-${t.slice(8,12)}-${t.slice(12,16)}-${t.slice(16,20)}-${t.slice(20,32)}`.replace(/-/g,"")}function D(e){return e.replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function O(e){return e||(e=new Date),e.toISOString().replace(/[-:.]/g,"").slice(0,-1)}class U{constructor({voice:e,rate:t="+0%",volume:n="+0%",pitch:r="+0Hz"}){this.voice=e,this.rate=t,this.volume=n,this.pitch=r,this.validate()}validate(){const e=/^([a-z]{2,})-([A-Z]{2,})-(.+Neural)$/.exec(this.voice);if(e){const[,t]=e;let[,,n,r]=e;if(r.includes("-")){const e=r.split("-");n+=`-${e[0]}`,r=e[1]}this.voice=`Microsoft Server Speech Text to Speech Voice (${t}-${n}, ${r})`}U.validateStringParam("voice",this.voice,/^Microsoft Server Speech Text to Speech Voice \(.+,.+\)$/),U.validateStringParam("rate",this.rate,/^[+-]\d+%$/),U.validateStringParam("volume",this.volume,/^[+-]\d+%$/),U.validateStringParam("pitch",this.pitch,/^[+-]\d+Hz$/)}static validateStringParam(e,t,n){if("string"!=typeof t)throw new TypeError(`${e} must be a string`);if(!n.test(t))throw new R(`Invalid ${e} '${t}'.`)}}const I="6A5AA1D4EAFF4E9FB37E23D68491D6F4",j=`wss://speech.platform.bing.com/consumer/speech/synthesize/readaloud/edge/v1?TrustedClientToken=${I}`,L="130.0.2849.68",_=L.split(".")[0],F=`1-${L}`,B={"User-Agent":`Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${_}.0.0.0 Safari/537.36 Edg/${_}.0.0.0`,"Accept-Encoding":"gzip, deflate, br","Accept-Language":"en-US,en;q=0.9"};Object.assign(Object.assign({},B),{Pragma:"no-cache","Cache-Control":"no-cache",Origin:"chrome-extension://jdiccldimpdaibmpdkjnbmckianbfold"}),Object.assign(Object.assign({},B),{Authority:"speech.platform.bing.com","Sec-CH-UA":`" Not;A Brand";v="99", "Microsoft Edge";v="${_}", "Chromium";v="${_}"`,"Sec-CH-UA-Mobile":"?0",Accept:"*/*","Sec-Fetch-Site":"none","Sec-Fetch-Mode":"cors","Sec-Fetch-Dest":"empty"});class W{static adjClockSkewSeconds(e){W.clockSkewSeconds+=e}static getUnixTimestamp(){return Date.now()/1e3+W.clockSkewSeconds}static parseRfc2616Date(e){try{return new Date(e).getTime()/1e3}catch(e){return null}}static handleClientResponseError(e){if(!e.headers)throw new S("No headers in response.");const t=e.headers.date||e.headers.Date;if(!t)throw new S("No server date in headers.");const n=W.parseRfc2616Date(t);if(null===n)throw new S(`Failed to parse server date: ${t}`);const r=W.getUnixTimestamp();W.adjClockSkewSeconds(n-r)}static generateSecMsGec(){return e=this,t=void 0,r=function*(){let e=W.getUnixTimestamp();e+=11644473600,e-=e%300,e*=1e7;const t=`${e.toFixed(0)}${I}`,n=(new TextEncoder).encode(t),r=yield crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join("").toUpperCase()},new((n=void 0)||(n=Promise))(function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())});var e,t,n,r}}W.clockSkewSeconds=0;const q=()=>navigator.userAgent.includes("Firefox");var H=function(e){return this instanceof H?(this.v=e,this):new H(e)},z=function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),s=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),i("next"),i("throw"),i("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),r[Symbol.asyncIterator]=function(){return this},r;function i(e,t){o[e]&&(r[e]=function(t){return new Promise(function(n,r){s.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{(n=o[e](t)).value instanceof H?Promise.resolve(n.value.v).then(c,l):d(s[0][2],n)}catch(e){d(s[0][3],e)}var n}function c(e){a("next",e)}function l(e){a("throw",e)}function d(e,t){e(t),s.shift(),s.length&&a(s[0][0],s[0][1])}},V=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,o){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,o,(t=e[n](t)).done,t.value)})}}};class G{static from(e,t){if("string"==typeof e)return(new TextEncoder).encode(e);if(e instanceof Uint8Array)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(e&&"object"==typeof e&&"byteLength"in e)return new Uint8Array(e);throw console.error("BrowserBuffer.from received unexpected input type:",typeof e,e),new Error("Unsupported input type for BrowserBuffer.from: "+typeof e)}static concat(e){const t=e.reduce((e,t)=>e+t.length,0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}}function X(e){if(e.length<2)throw new Error("Message too short to contain header length");const t=e[0]<<8|e[1],n={};if(t>0&&t+2<=e.length){const r=e.slice(2,t+2),o=(new TextDecoder).decode(r).split("\r\n");for(const e of o){const[t,r]=e.split(":",2);t&&r&&(n[t]=r.trim())}}return[n,e.slice(t+2)]}class Z{constructor(e,t={}){if(this.state={partialText:G.from(""),offsetCompensation:0,lastDurationOffset:0,streamWasCalled:!1},this.ttsConfig=new U({voice:t.voice||"en-US-EmmaMultilingualNeural",rate:t.rate,volume:t.volume,pitch:t.pitch}),"string"!=typeof e)throw new TypeError("text must be a string");const n=q()?32768:4096;this.texts=function(e,t){return function*(){let n=(new TextEncoder).encode(e);if(t<=0)throw new Error("byteLength must be greater than 0");for(;n.length>t;){let e=t;const r=n.slice(0,t),o=(new TextDecoder).decode(r),s=o.lastIndexOf("\n"),i=o.lastIndexOf(" ");s>0?e=(new TextEncoder).encode(o.substring(0,s)).length:i>0&&(e=(new TextEncoder).encode(o.substring(0,i)).length);const a=n.slice(0,e),c=(new TextDecoder).decode(a).trim();c&&(yield(new TextEncoder).encode(c)),n=n.slice(e)}const r=(new TextDecoder).decode(n).trim();r&&(yield(new TextEncoder).encode(r))}()}(function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}(function(e){let t=e;for(const e of'*/()[]{}$%^@#+=|\\~`><"&')t=t.replace(new RegExp("\\"+e,"g"),"");return t}(e)),n),this.connectionTimeout=t.connectionTimeout}parseMetadata(e){const t=JSON.parse((new TextDecoder).decode(e));for(const e of t.Metadata){const t=e.Type;if("WordBoundary"===t)return{type:t,offset:e.Data.Offset+this.state.offsetCompensation,duration:e.Data.Duration,text:D(e.Data.text.Text)};if("SessionEnd"!==t)throw new C(`Unknown metadata type: ${t}`)}throw new P("No WordBoundary metadata found")}_stream(){return z(this,arguments,function*(){const e=`${j}&Sec-MS-GEC=${yield H(W.generateSecMsGec())}&Sec-MS-GEC-Version=${F}&ConnectionId=${M()}`,t=new WebSocket(e),n=[];let r,o=null;this.connectionTimeout&&(r=window.setTimeout(()=>{t.close(),n.push(new $("Connection timeout")),o&&o()},this.connectionTimeout)),t.onmessage=e=>{r&&(window.clearTimeout(r),r=void 0);const s=e.data;if(s instanceof ArrayBuffer||Blob,"string"==typeof s){const[e,r]=function(e){const t=(new TextDecoder).decode(e),n=t.indexOf("\r\n\r\n"),r={};if(-1!==n){const e=t.substring(0,n).split("\r\n");for(const t of e){const[e,n]=t.split(":",2);e&&n&&(r[e]=n.trim())}}const o=(new TextEncoder).encode(t.substring(0,n+4)).length;return[r,e.slice(o)]}(G.from(s)),o=e.Path;if("audio.metadata"===o)try{const e=this.parseMetadata(r);this.state.lastDurationOffset=e.offset+e.duration,n.push(e)}catch(e){n.push(e)}else"turn.end"===o?(this.state.offsetCompensation=this.state.lastDurationOffset,t.close()):"response"!==o&&"turn.start"!==o&&n.push(new C(`Unknown path received: ${o}`))}else if(s instanceof ArrayBuffer){const e=G.from(s);if(e.length<2)n.push(new P("We received a binary message, but it is missing the header length."));else{const[t,r]=X(e);if("audio"!==t.Path)n.push(new P("Received binary message, but the path is not audio."));else{const e=t["Content-Type"]||"";"audio/mpeg"!==e&&!e.startsWith("audio/webm")&&"audio/webm"!==e&&e?r.length>0&&n.push(new P(`Received binary message with unexpected Content-Type: ${e}`)):0===r.length||n.push({type:"audio",data:r})}}}else if(s instanceof Blob){const e=new FileReader;return e.onload=()=>{try{const t=e.result,r=t.byteLength,o=new Uint8Array(r),s=new Uint8Array(t);for(let e=0;e<r;e++)o[e]=s[e];if(o.length<2)n.push(new P("We received a binary message, but it is missing the header length."));else{const[e,t]=X(o);if("audio"!==e.Path)n.push(new P("Received binary message, but the path is not audio."));else{const r=e["Content-Type"]||"";"audio/mpeg"!==r&&!r.startsWith("audio/webm")&&"audio/webm"!==r&&r?t.length>0&&n.push(new P(`Received binary message with unexpected Content-Type: ${r}`)):0===t.length||n.push({type:"audio",data:t})}}}catch(e){console.error("Error processing Blob data:",e),n.push(new P(`Failed to process Blob: ${e}`))}o&&(o(),o=null)},e.onerror=()=>{console.error("FileReader error:",e.error),n.push(new P("Failed to read Blob data")),o&&(o(),o=null)},void e.readAsArrayBuffer(s)}o&&o()},t.onerror=e=>{r&&(window.clearTimeout(r),r=void 0),n.push(new $("WebSocket connection failed. The TTS service may be temporarily unavailable.")),o&&o()},t.onclose=()=>{r&&(window.clearTimeout(r),r=void 0),n.push("close"),o&&o()},yield H(new Promise((e,n)=>{let o=!1;t.onopen=()=>{o||(o=!0,r&&(window.clearTimeout(r),r=void 0),e())};const s=t.onerror;t.onerror=e=>{o?s&&s.call(t,e):(o=!0,n(new $("Failed to connect to TTS service. Please try again.")))},this.connectionTimeout&&setTimeout(()=>{o||t.readyState!==WebSocket.CONNECTING||(o=!0,t.close(),n(new $("Connection timeout")))},this.connectionTimeout)}));const s=q()?"webm-24khz-16bit-mono-opus":"audio-24khz-48kbitrate-mono-mp3";var i,a,c;t.send(`X-Timestamp:${O()}\r\nContent-Type:application/json; charset=utf-8\r\nPath:speech.config\r\n\r\n{"context":{"synthesis":{"audio":{"metadataoptions":{"sentenceBoundaryEnabled":"false","wordBoundaryEnabled":"true"},"outputFormat":"${s}"}}}}\r\n`),t.send((i=M(),a=O(),c=function(e,t){const n=t instanceof Uint8Array?(new TextDecoder).decode(t):t;return`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xml:lang='en-US'><voice name='${e.voice}'><prosody pitch='${e.pitch}' rate='${e.rate}' volume='${e.volume}'>${n}</prosody></voice></speak>`}(this.ttsConfig,(new TextDecoder).decode(this.state.partialText)),`X-RequestId:${i}\r\nContent-Type:application/ssml+xml\r\nX-Timestamp:${a}Z\r\nPath:ssml\r\n\r\n${c}`));let l=!1;for(;;)if(n.length>0){const e=n.shift();if("close"===e){if(!l)throw new N("No audio was received.");break}if(e instanceof Error)throw e;"audio"===e.type&&(l=!0),yield yield H(e)}else yield H(new Promise(e=>{o=e,setTimeout(e,50)}))})}stream(){return z(this,arguments,function*(){var e,t,n,r;if(this.state.streamWasCalled)throw new Error("stream can only be called once.");this.state.streamWasCalled=!0;for(const a of this.texts){this.state.partialText=a;try{for(var o,s=!0,i=(t=void 0,V(this._stream()));!(e=(o=yield H(i.next())).done);s=!0){r=o.value,s=!1;const e=r;yield yield H(e)}}catch(e){t={error:e}}finally{try{s||e||!(n=i.return)||(yield H(n.call(i)))}finally{if(t)throw t.error}}}})}}var J=function(e,t,n,r){return new(n||(n=Promise))(function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})},K=function(e,t,n,r){return new(n||(n=Promise))(function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,a)}c((r=r.apply(e,t||[])).next())})};let Q=null,Y=!1,ee=!1;const te=new class{constructor(e={}){this.audioElement=null,this.isPlaying=!1,this.currentTTSDeactivate=null,this.callbacks=e}play(e,t){return J(this,void 0,void 0,function*(){var n,r,o,s;this.currentTTSDeactivate&&this.currentTTSDeactivate(),this.cleanup();try{null===(r=(n=this.callbacks).onLoading)||void 0===r||r.call(n);const o=(null==t?void 0:t.customVoice)||(null==t?void 0:t.voiceName)||"en-US-ChristopherNeural",s=(null==t?void 0:t.speed)||1.2,i=Math.round(100*(s-1)),a=new Z(e,{voice:o,rate:i>=0?`+${i}%`:`${i}%`,connectionTimeout:1e4});return new Promise((e,t)=>{const n=new MediaSource;let r;const o=[];let s=!0,i=!0;this.currentTTSDeactivate=()=>{i=!1},this.audioElement||(this.audioElement=new Audio,this.audioElement.muted=!0,this.audioElement.src=URL.createObjectURL(n),this.audioElement.onplay=()=>{var e,t;this.audioElement&&(this.audioElement.muted=!1),this.isPlaying=!0,null===(t=(e=this.callbacks).onPlaying)||void 0===t||t.call(e)},this.audioElement.onpause=()=>{var e,t;this.isPlaying=!1,null===(t=(e=this.callbacks).onPaused)||void 0===t||t.call(e)},this.audioElement.onended=()=>{var e,t;this.isPlaying=!1,null===(t=(e=this.callbacks).onStopped)||void 0===t||t.call(e),this.cleanup()},this.audioElement.onerror=e=>{var t,n,r,o,s,i,a,c,l,d,u,g,m,p,f,h,A,x;const v={errorCode:null===(n=null===(t=this.audioElement)||void 0===t?void 0:t.error)||void 0===n?void 0:n.code,errorMessage:null===(o=null===(r=this.audioElement)||void 0===r?void 0:r.error)||void 0===o?void 0:o.message,errorType:1===(null===(i=null===(s=this.audioElement)||void 0===s?void 0:s.error)||void 0===i?void 0:i.code)?"MEDIA_ERR_ABORTED":2===(null===(c=null===(a=this.audioElement)||void 0===a?void 0:a.error)||void 0===c?void 0:c.code)?"MEDIA_ERR_NETWORK":3===(null===(d=null===(l=this.audioElement)||void 0===l?void 0:l.error)||void 0===d?void 0:d.code)?"MEDIA_ERR_DECODE":4===(null===(g=null===(u=this.audioElement)||void 0===u?void 0:u.error)||void 0===g?void 0:g.code)?"MEDIA_ERR_SRC_NOT_SUPPORTED":"UNKNOWN"};4===v.errorCode&&((null===(m=v.errorMessage)||void 0===m?void 0:m.includes("URL safety"))||(null===(p=v.errorMessage)||void 0===p?void 0:p.includes("CSP")))||console.error("Audio playback error:",v),null===(h=(f=this.callbacks).onError)||void 0===h||h.call(f,(null===(x=null===(A=this.audioElement)||void 0===A?void 0:A.error)||void 0===x?void 0:x.message)||"Audio playback error"),this.cleanup()});const c=()=>{var e;if(i&&r&&"open"===n.readyState&&o.length>0&&!r.updating)try{const t=o.shift();if(t){const n=new Uint8Array(t.length);n.set(t),r.appendBuffer(n),s&&(q()?setTimeout(()=>{var e;null===(e=this.audioElement)||void 0===e||e.play().catch(e=>{console.warn("Firefox autoplay workaround failed:",e)})},0):null===(e=this.audioElement)||void 0===e||e.play().catch(e=>{console.warn("Audio playback failed:",e)}),s=!1)}}catch(e){console.error("appendNextChunk error:",e),o.shift(),i&&setTimeout(c,100)}};n.addEventListener("sourceopen",()=>{try{const s=q()?'audio/webm; codecs="opus"':"audio/mpeg";r=n.addSourceBuffer(s),r.addEventListener("updateend",c),(()=>{J(this,void 0,void 0,function*(){var s,l,d,u,g,m;try{let t=!1;try{for(var p,f=!0,h=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,o){!function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}(r,o,(t=e[n](t)).done,t.value)})}}}(a.stream());!(s=(p=yield h.next()).done);f=!0){u=p.value,f=!1;const e=u;if(!i)return void(t=!0);if("audio"===e.type&&e.data){const t=new Uint8Array(e.data.byteLength);t.set(e.data),o.push(t),c()}}}catch(e){l={error:e}}finally{try{f||s||!(d=h.return)||(yield d.call(h))}finally{if(l)throw l.error}}t=!0;const g=()=>{if(i)if(t&&0===o.length&&!r.updating)try{"open"===n.readyState&&n.endOfStream(),e(void 0)}catch(t){e(void 0)}else setTimeout(g,100)};g()}catch(e){console.error("TTS streaming error:",e),null===(m=(g=this.callbacks).onError)||void 0===m||m.call(g,e.message||"TTS streaming error"),t(e)}})})()}catch(e){t(e)}})})}catch(e){throw console.error("TTS Error:",e),null===(s=(o=this.callbacks).onError)||void 0===s||s.call(o,e.message||"TTS initialization error"),this.cleanup(),e}})}togglePause(){this.audioElement&&(this.audioElement.paused?this.audioElement.play():this.audioElement.pause())}stop(){var e,t;this.audioElement&&(this.audioElement.pause(),this.audioElement.currentTime=0),this.cleanup(),null===(t=(e=this.callbacks).onStopped)||void 0===t||t.call(e)}getIsPlaying(){return this.isPlaying}hasAudio(){return null!==this.audioElement}cleanup(){if(this.currentTTSDeactivate&&(this.currentTTSDeactivate(),this.currentTTSDeactivate=null),this.audioElement){this.audioElement.onplay=null,this.audioElement.onpause=null,this.audioElement.onended=null,this.audioElement.onerror=null;const e=this.audioElement.src;this.audioElement.pause(),this.audioElement.src="",this.audioElement.load(),e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)}this.audioElement=null,this.isPlaying=!1}}({onLoading:()=>{},onPlaying:()=>{Y=!0,Q&&y(Q,!1),ie()},onPaused:()=>{Y=!1,ie()},onStopped:()=>{Y=!1,ie(),le()},onError:e=>{e&&(e.includes("URL safety check")||e.includes("CSP")||e.includes("Content Security Policy")||e.includes("MEDIA_ERR_SRC_NOT_SUPPORTED"))?ne?(se(ne,re||{}).catch(e=>{console.error("Offscreen fallback failed:",e),le()}),ne=null,re=null):(console.warn("No pending text for CSP fallback"),le()):(console.error("TTS playback error:",e),Q?y(Q,!1,e||"Unknown playback error"):le())}});let ne=null,re=null;function oe(e){return K(this,arguments,void 0,function*(e,n=!1){te.cleanup(),le(),ne=null,re=null;try{const r=yield t().storage.sync.get({voiceName:"en-US-ChristopherNeural",customVoice:"",speed:1.2});if(n)return void(yield se(e,r));ne=e,re=r,Q=yield v(!0);try{navigator.mediaSession.setActionHandler("play",()=>te.togglePause()),navigator.mediaSession.setActionHandler("pause",()=>te.togglePause()),navigator.mediaSession.setActionHandler("stop",()=>ce())}catch(e){}yield te.play(e,{voiceName:r.voiceName,customVoice:r.customVoice,speed:r.speed})}catch(e){console.error("TTS Error:",e);const t=(null==e?void 0:e.message)||String(e);if(t.includes("URL safety check")||t.includes("CSP")||t.includes("Content Security Policy")||t.includes("MEDIA_ERR_SRC_NOT_SUPPORTED"))return void(yield function(){return K(this,void 0,void 0,function*(){if(!ne)return console.error("No pending text for offscreen fallback"),void le();yield se(ne,re||{}),ne=null,re=null})}());Q?y(Q,!1,String(t)):le()}})}function se(e,n){return K(this,void 0,void 0,function*(){ee=!0,Q||(Q=yield v(!0));try{yield t().runtime.sendMessage({action:"requestOffscreenPlayback",text:e,settings:{voiceName:n.voiceName||"en-US-ChristopherNeural",customVoice:n.customVoice||"",speed:n.speed||1.2}})}catch(e){console.error("Content: Failed to request offscreen playback:",e),le(),ee=!1}})}function ie(){const e=document.querySelector("#tts-pause");if(e){const t=Y?"Pause":"Resume";e.innerHTML=`\n      ${Y?A:'\n<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-circle-play"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>\n'}\n      <span>${t}</span>\n    `}}function ae(){ee?t().runtime.sendMessage({action:"offscreen:togglePlayback"}).catch(()=>{}):te.togglePause()}function ce(){if(ee)return t().runtime.sendMessage({action:"offscreen:stopPlayback"}).catch(()=>{}),ee=!1,void le();te.stop()}function le(){Q&&(Q.querySelectorAll("button").forEach(e=>{var t;const n=e.cloneNode(!0);null===(t=e.parentNode)||void 0===t||t.replaceChild(n,e)}),Q.parentNode&&Q.parentNode.removeChild(Q)),Q=null}function de(e){switch(e){case"loading":Q&&y(Q,!0);break;case"playing":Y=!0,Q&&y(Q,!1),ie();break;case"paused":Y=!1,ie();break;case"stopped":Y=!1,ee=!1,le();break;case"error":Y=!1,ee=!1,Q?y(Q,!1,"Offscreen playback error"):le()}}window.togglePause=ae,window.stopPlayback=ce,t().runtime.onMessage.addListener(function(e,n,r){if("ping"===e.action)return r({pong:!0}),!0;if("stopPlayback"===e.action)ee?(t().runtime.sendMessage({action:"offscreen:stopPlayback"}).catch(()=>{}),le()):ce();else if("togglePlayback"===e.action)ee?t().runtime.sendMessage({action:"offscreen:togglePlayback"}).catch(()=>{}):ae();else if("readText"===e.action)oe(e.text).catch(e=>{});else if("readPage"===e.action){const e=document.body.innerText;e&&""!==e.trim()?oe(e).catch(e=>{}):console.warn("The page content is empty.")}else if("readFromHere"===e.action&&e.text)try{let t=b(e.text);t&&0!==t.trim().length||(t=E(e.text)),t&&""!==t.trim()?oe(t).catch(e=>{}):(console.warn("No text found from selection point."),oe(e.text).catch(e=>{}))}catch(t){console.error("Error extracting text from selection:",t),oe(e.text).catch(e=>{})}else if("showPlaybackUI"===e.action)ee=!0,function(){K(this,void 0,void 0,function*(){te.cleanup(),le(),Q=yield v(!0)})}();else if("updatePlaybackState"===e.action)o=e.state,e.error,Q||"stopped"===o?de(o):v("loading"===o).then(e=>{Q=e,de(o)});else if("extractTextFromHere"===e.action&&e.text){try{let t=b(e.text);t&&0!==t.trim().length||(t=E(e.text)),t&&0!==t.trim().length||(t=e.text),r({text:t})}catch(t){console.error("Error extracting text:",t),r({text:e.text})}return!0}var o}),window.addEventListener("message",e=>{if(e.source!==window)return;const{action:t,text:n}=e.data||{};"triggerTTS"===t&&"string"==typeof n&&oe(n).catch(e=>console.error("initTTS error:",e))}),window.addEventListener("beforeunload",()=>{te.cleanup()})})()})();